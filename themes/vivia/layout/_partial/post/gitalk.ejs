<link rel="stylesheet" href="https://unpkg.com/gitalk@latest/dist/gitalk.css">
<style>
  /* Gitalk 样式优化 - 仿照第三张图 */
  .gt-container {
    background: #ffffff !important;
    border-radius: 8px !important;
    padding: 20px !important;
  }
  .gt-container .gt-header {
    border-bottom: 1px solid #e1e4e8 !important;
    padding-bottom: 16px !important;
    margin-bottom: 16px !important;
  }
  .gt-container .gt-header-textarea {
    background: #f6f8fa !important;
    border: 1px solid #d0d7de !important;
    border-radius: 6px !important;
    min-height: 100px !important;
  }
  .gt-container .gt-btn {
    border-radius: 6px !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    padding: 6px 16px !important;
  }
  .gt-container .gt-btn-login {
    background: #2da44e !important;
    border-color: #2da44e !important;
    color: #ffffff !important;
  }
  .gt-container .gt-btn-login:hover {
    background: #2c974b !important;
    border-color: #2c974b !important;
  }
  .gt-container .gt-btn-preview {
    background: #f6f8fa !important;
    border-color: #d0d7de !important;
    color: #24292f !important;
  }
  .gt-container .gt-btn-public {
    background: #2da44e !important;
    border-color: #2da44e !important;
    color: #ffffff !important;
  }
  .gt-container .gt-comment {
    border-bottom: 1px solid #d8dee4 !important;
    padding: 16px 0 !important;
  }
  .gt-container .gt-comment-content {
    background: #ffffff !important;
    border-radius: 6px !important;
  }
  .gt-container .gt-comment-header {
    margin-bottom: 8px !important;
  }
  .gt-container .gt-comment-username {
    color: #57606a !important;
    font-weight: 600 !important;
    font-size: 14px !important;
  }
  .gt-container .gt-comment-text {
    color: #24292f !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
  }
  .gt-container .gt-avatar {
    border-radius: 50% !important;
    width: 40px !important;
    height: 40px !important;
  }
  .gt-container .gt-avatar img {
    border-radius: 50% !important;
    width: 40px !important;
    height: 40px !important;
  }
  .gt-container .gt-no-init {
    text-align: center !important;
    padding: 40px 20px !important;
  }
  .gt-container .gt-no-init p {
    color: #57606a !important;
    margin-bottom: 16px !important;
  }
  .gt-container .gt-link {
    color: #0969da !important;
  }
  .gt-container .gt-link:hover {
    text-decoration: underline !important;
  }
  .gt-container .gt-meta {
    margin-bottom: 16px !important;
  }
  .gt-container .gt-popup {
    background: #ffffff !important;
    border: 1px solid #d0d7de !important;
    border-radius: 6px !important;
    box-shadow: 0 8px 24px rgba(140,149,159,0.2) !important;
  }
</style>
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        var gitalkContainer = document.getElementById('gitalk-container');
        if (!gitalkContainer) {
            console.error('Gitalk container not found');
            return;
        }
        
        // 使用简单的字符串处理代替MD5
        var path = location.pathname;
        var id = path.replace(/\//g, '-').replace(/^-|-$/g, '') || 'index';
        // 限制ID长度不超过50个字符（GitHub Issue标签限制）
        if (id.length > 50) {
            id = id.substring(0, 50);
        }
        
        var gitalk = new Gitalk({
            clientID: '<%- theme.comment.gitalk.ClientID %>',
            clientSecret: '<%- theme.comment.gitalk.ClientSecret %>',
            repo: '<%- theme.comment.gitalk.repo %>',
            owner: '<%- theme.comment.gitalk.owner %>',
            admin: ['<%- theme.comment.gitalk.admin %>'],
            id: id,
            distractionFreeMode: <%- theme.comment.gitalk.distractionFreeMode %>,
            language: 'zh-CN'
        });
        
        gitalk.render('gitalk-container');
    });
</script>