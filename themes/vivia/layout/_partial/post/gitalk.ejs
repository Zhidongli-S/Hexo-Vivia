<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css">
<div id="gitalk-container"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js"></script>
<script>
  (function() {
    var container = document.getElementById('gitalk-container');
    if (!container) return;
    
    // 生成页面ID
    var path = location.pathname.replace(/\//g, '-').replace(/^-|-$/g, '') || 'index';
    if (path.length > 50) path = path.substring(0, 50);
    
    // 初始化Gitalk
    var gitalk = new Gitalk({
      clientID: '<%- theme.comment.gitalk.ClientID %>',
      clientSecret: '<%- theme.comment.gitalk.ClientSecret %>',
      repo: '<%- theme.comment.gitalk.repo %>',
      owner: '<%- theme.comment.gitalk.owner %>',
      admin: ['<%- theme.comment.gitalk.admin %>'],
      id: path,
      number: -1,
      labels: ['gitalk'],
      title: document.title,
      body: location.href,
      language: 'zh-CN',
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: false,
      distractionFreeMode: false,
      proxy: 'https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token'
    });
    
    // 渲染
    gitalk.render('gitalk-container');
  })();
</script>