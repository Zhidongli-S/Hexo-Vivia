<link rel="stylesheet" href="https://unpkg.com/gitalk@latest/dist/gitalk.css">
<style>
  /* Gitalk 样式 - 完全仿照第三张图 */
  .gt-container {
    background: #ffffff !important;
    border: 1px solid #d0d7de !important;
    border-radius: 6px !important;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif !important;
  }
  
  /* 头部输入区域 */
  .gt-container .gt-header {
    padding: 16px !important;
    border-bottom: 1px solid #d8dee4 !important;
  }
  
  .gt-container .gt-header-comment {
    display: flex !important;
    gap: 12px !important;
  }
  
  /* 头像 */
  .gt-container .gt-avatar {
    width: 40px !important;
    height: 40px !important;
    border-radius: 50% !important;
    flex-shrink: 0 !important;
  }
  
  .gt-container .gt-avatar img {
    width: 40px !important;
    height: 40px !important;
    border-radius: 50% !important;
  }
  
  /* 输入框区域 */
  .gt-container .gt-header-controls {
    flex: 1 !important;
    position: relative !important;
  }
  
  .gt-container .gt-header-textarea {
    width: 100% !important;
    min-height: 100px !important;
    padding: 12px !important;
    background: #f6f8fa !important;
    border: 1px solid #d0d7de !important;
    border-radius: 6px !important;
    font-size: 14px !important;
    color: #24292f !important;
    resize: vertical !important;
  }
  
  .gt-container .gt-header-textarea:focus {
    background: #ffffff !important;
    border-color: #0969da !important;
    outline: none !important;
    box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.3) !important;
  }
  
  /* 预览按钮 */
  .gt-container .gt-header-controls .gt-btn-preview {
    position: absolute !important;
    top: 8px !important;
    right: 8px !important;
    background: transparent !important;
    border: none !important;
    color: #57606a !important;
    font-size: 12px !important;
    padding: 4px 8px !important;
  }
  
  /* 底部按钮区域 */
  .gt-container .gt-header-controls .gt-svg {
    display: none !important;
  }
  
  /* 登录按钮 - 绿色 */
  .gt-container .gt-btn-login {
    float: right !important;
    margin-top: 8px !important;
    background: #2da44e !important;
    border: 1px solid rgba(27, 31, 36, 0.15) !important;
    color: #ffffff !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    padding: 5px 16px !important;
    border-radius: 6px !important;
    cursor: pointer !important;
  }
  
  .gt-container .gt-btn-login:hover {
    background: #2c974b !important;
  }
  
  /* 评论列表 */
  .gt-container .gt-comments {
    padding: 0 16px !important;
  }
  
  .gt-container .gt-comment {
    display: flex !important;
    gap: 12px !important;
    padding: 16px 0 !important;
    border-bottom: 1px solid #d8dee4 !important;
  }
  
  .gt-container .gt-comment:last-child {
    border-bottom: none !important;
  }
  
  /* 评论内容 */
  .gt-container .gt-comment-content {
    flex: 1 !important;
  }
  
  .gt-container .gt-comment-header {
    margin-bottom: 4px !important;
  }
  
  .gt-container .gt-comment-username {
    color: #57606a !important;
    font-weight: 600 !important;
    font-size: 14px !important;
    text-decoration: none !important;
  }
  
  .gt-container .gt-comment-username:hover {
    color: #0969da !important;
  }
  
  .gt-container .gt-comment-date {
    color: #57606a !important;
    font-size: 12px !important;
    margin-left: 8px !important;
  }
  
  .gt-container .gt-comment-text {
    color: #24292f !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
  }
  
  /* 评论操作按钮 */
  .gt-container .gt-comment-actions {
    margin-top: 8px !important;
  }
  
  .gt-container .gt-comment-actions a {
    color: #57606a !important;
    font-size: 12px !important;
    margin-right: 16px !important;
    text-decoration: none !important;
  }
  
  .gt-container .gt-comment-actions a:hover {
    color: #0969da !important;
  }
  
  /* 回复 */
  .gt-container .gt-comment-replies {
    margin-top: 12px !important;
    margin-left: 52px !important;
  }
  
  .gt-container .gt-comment-reply {
    display: flex !important;
    gap: 12px !important;
    padding: 12px 0 !important;
    border-top: 1px solid #d8dee4 !important;
  }
  
  /* 加载更多 */
  .gt-container .gt-comments-loadmore {
    text-align: center !important;
    padding: 16px !important;
  }
  
  .gt-container .gt-comments-loadmore .gt-btn-loadmore {
    color: #0969da !important;
    font-size: 14px !important;
    text-decoration: none !important;
  }
  
  /* 初始化提示 */
  .gt-container .gt-no-init {
    text-align: center !important;
    padding: 32px 16px !important;
  }
  
  .gt-container .gt-no-init p {
    color: #57606a !important;
    font-size: 14px !important;
    margin-bottom: 16px !important;
  }
  
  .gt-container .gt-no-init a {
    color: #0969da !important;
    text-decoration: none !important;
  }
  
  .gt-container .gt-no-init a:hover {
    text-decoration: underline !important;
  }
  
  /* 底部 */
  .gt-container .gt-footer {
    padding: 16px !important;
    border-top: 1px solid #d8dee4 !important;
    text-align: center !important;
  }
  
  .gt-container .gt-footer a {
    color: #57606a !important;
    font-size: 12px !important;
    text-decoration: none !important;
  }
  
  /* 弹出框 */
  .gt-container .gt-popup {
    background: #ffffff !important;
    border: 1px solid #d0d7de !important;
    border-radius: 6px !important;
    box-shadow: 0 8px 24px rgba(140, 149, 159, 0.2) !important;
  }
  
  /* 表情选择器 */
  .gt-container .gt-emoji-picker {
    background: #ffffff !important;
    border: 1px solid #d0d7de !important;
    border-radius: 6px !important;
  }
</style>
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        var gitalkContainer = document.getElementById('gitalk-container');
        if (!gitalkContainer) {
            console.error('Gitalk container not found');
            return;
        }
        
        // 使用简单的字符串处理代替MD5
        var path = location.pathname;
        var id = path.replace(/\//g, '-').replace(/^-|-$/g, '') || 'index';
        // 限制ID长度不超过50个字符（GitHub Issue标签限制）
        if (id.length > 50) {
            id = id.substring(0, 50);
        }
        
        var gitalk = new Gitalk({
            clientID: '<%- theme.comment.gitalk.ClientID %>',
            clientSecret: '<%- theme.comment.gitalk.ClientSecret %>',
            repo: '<%- theme.comment.gitalk.repo %>',
            owner: '<%- theme.comment.gitalk.owner %>',
            admin: ['<%- theme.comment.gitalk.admin %>'],
            id: id,
            distractionFreeMode: <%- theme.comment.gitalk.distractionFreeMode %>,
            language: 'zh-CN',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token'
        });
        
        gitalk.render('gitalk-container');
    });
</script>